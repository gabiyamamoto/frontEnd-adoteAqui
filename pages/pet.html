<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detalhes do Pet</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        color: #07353f;
        background-image: url(../assets/img/background.png);
    }

    .cabecalho {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
    }

    .logo {
        width: 85px;
    }

    .voltar {
        background: rgba(255,255,255,0.25);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);

        padding: 10px 25px;
        border: 1px solid rgba(255,255,255,0.35);
        border-radius: 20px;

        color: #fff;
        font-size: 18px;
        cursor: pointer;

        box-shadow: 0 4px 18px rgba(0,0,0,0.15);

        transition: 0.25s ease;
    }

    .voltar:hover {
        background: rgba(255,255,255,0.38);
        border-color: rgba(255,255,255,0.55);
        transform: translateY(-2px);
        box-shadow: 0 6px 22px rgba(0,0,0,0.22);
    }

    .voltar:active {
        transform: translateY(0px) scale(0.97);
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }

    #pet-info {
        max-width: 1100px;
        margin: 30px auto;
        padding: 0 16px 60px;
    }

    .card-pet {
        background: #7ee6f0;
        padding: 30px;
        border-radius: 25px;
        position: relative;
        box-shadow: 0 18px 50px rgba(5,60,70,0.18);
        border: 1px solid rgba(255,255,255,0.35);
    }

    .pet-wrapper {
        display: flex;
        gap: 30px;
        align-items: flex-start;
        flex-wrap: wrap;
    }

    .pet-left {
        flex: 0 0 380px;
    }

    .pet-left img {
        width: 100%;
        border-radius: 18px;
        margin-top: 10px;
        display: block;
        box-shadow: 0 12px 35px rgba(0,0,0,0.22);
        border: 3px solid rgba(255,255,255,0.6);
        object-fit: cover;
        height: 380px;
    }

    .pet-right {
        flex: 1 1 480px;
        min-width: 260px;
    }

    .card-pet h1 {
        font-size: 32px;
        margin: 0;
        color: #07353f;
    }

    .card-pet h1 span {
        font-size: 48px;
        font-weight: 700;
        color: #fff;
        text-shadow: 0px 0px 7px #0d5e6b;
    }

    .balao {
        background: #00bcd4;
        padding: 13px 22px;
        border-radius: 30px;
        position: absolute;
        right: 40px;
        top: 140px;
        color: white;
        font-size: 20px;
        font-weight: bold;
        box-shadow: 0 8px 26px rgba(0,0,0,0.18);
        opacity: 0;
    }

    .cloud-box {
        margin-top: 18px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .cloud {
        background: rgba(255,255,255,0.95);
        padding: 12px 18px;
        border-radius: 999px;
        font-size: 18px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        color: #064650;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        border: 1px solid rgba(255,255,255,0.8);
        min-height: 48px;
    }

    .cloud.small {
        padding: 8px 12px;
        font-size: 15px;
        min-height: 40px;
    }

    .cloud::before {
        content: "üêæ";
        filter: drop-shadow(0 0 2px rgba(13,93,107,0.6));
    }

    .descricao {
        margin-top: 22px;
        background: rgba(255,255,255,0.18);
        padding: 18px;
        border-radius: 16px;
        color: #04393f;
        line-height: 1.5;
        border: 1px solid rgba(255,255,255,0.35);
        box-shadow: inset 0 0 12px rgba(255,255,255,0.06);
    }

    .btn-adotar {
        margin-top: 20px;
        padding: 12px 22px;
        border-radius: 20px;
        background: #bcecff;
        border: none;
        font-size: 20px;
        cursor: pointer;
        font-weight: 700;
        color: #034b56;
        box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        transition: transform .18s ease, box-shadow .18s ease;
    }

    .btn-adotar:hover {
        transform: translateY(-3px);
        box-shadow: 0 16px 36px rgba(0,0,0,0.18);
    }

    .meta {
        margin-top: 12px;
        display:flex;
        gap: 10px;
        flex-wrap:wrap;
    }

    .meta .pill {
        background: rgba(255,255,255,0.9);
        padding: 8px 12px;
        border-radius: 12px;
        color: #064650;
        font-weight: 600;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        border: 1px solid rgba(255,255,255,0.6);
    }

    @media (max-width: 900px) {
        .pet-wrapper { flex-direction: column; }
        .pet-left { flex: 1 1 100%; }
        .pet-left img { height: auto; max-height: 420px; }
        .balao { position: static; margin-top: 14px; right: unset; top: unset; opacity: 0; }
    }

    @media (max-width: 480px) {
        .card-pet h1 { font-size: 26px; }
        .pet-left img { height: 300px; }
        .cloud { font-size: 16px; padding: 10px 14px; min-height: 44px; }
    }

  </style>
</head>
<body>

  <div class="cabecalho">
    <img class="logo" src="../assets/img/logo.png" alt="logo" />
    <button class="voltar" onclick="history.back()">Voltar</button>
  </div>

  <div id="pet-info">
    <div class="card-pet">
      <div class="pet-wrapper">

        <div class="pet-left">
          <img id="pet-foto" src="https://via.placeholder.com/600x400?text=Carregando..." alt="Foto do pet">
        </div>

        <div class="pet-right">
          <h1 id="pet-nome">Carregando...</h1>

          <div id="balao-container"></div>

          <div class="cloud-box" id="clouds">
          </div>

          <div class="meta" id="meta">
          </div>

          <div class="descricao" id="pet-descricao">
          </div>

          <button class="btn-adotar" id="btn-adotar">Adotar üíô</button>
        </div>
      </div>
    </div>
  </div>

<script>
    const API_URL = "https://backend-adoteaqui-06i1.onrender.com";
    let tipos = [];

    function showLocalError(msg) {
      const card = document.querySelector(".card-pet");
      if(card) {
        card.innerHTML = '<p style="color:#07353f; text-align:center; padding:30px; font-weight:bold;">' + msg + '</p>';
      }
      console.warn(msg);
    }

    async function carregarTipos() {
      try {
        const res = await fetch(`${API_URL}/tipos`);
        if (!res.ok) throw new Error('Erro ao buscar tipos');
        const data = await res.json();
        tipos = data.tipos || [];
      } catch (err) {
        console.error("Erro tipos:", err);
        tipos = [];
      }
    }

    function getPetId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function carregarPet(id) {
      try {
        const res = await fetch(`${API_URL}/pets/${id}`);
        
        if (!res.ok) {
          console.warn('Busca direta falhou, tentando buscar na lista geral...');
          const resAll = await fetch(`${API_URL}/pets`);
          const dataAll = await resAll.json();
          const pets = dataAll.pets || [];
          const pet = pets.find(p => String(p.id) === String(id));
          if (!pet) throw new Error('Pet n√£o encontrado na lista');
          return pet;
        }

        const data = await res.json();
        return data.pet || data;
      } catch (err) {
        throw err;
      }
    }

    function montarInfos(pet) {
      const tipo = tipos.find(t => String(t.id) === String(pet.tipoId));
      
      const imgUrl = pet.imageUrl || tipo?.imageUrl || pet.image || pet.foto || "../assets/img/default.jpg";
      
      const imgEl = document.getElementById('pet-foto');
      if(imgEl) {
        imgEl.src = imgUrl;
        imgEl.alt = pet.nome || 'Pet';
      }

      document.getElementById('pet-nome').textContent = pet.nome || 'Nome n√£o informado';

      const balaoContainer = document.getElementById('balao-container');
      balaoContainer.innerHTML = '';
      if (pet.idade || pet.sexo) {
        const b = document.createElement('div');
        b.className = 'balao';
        b.style.opacity = "1";
        b.textContent = `${pet.idade ? pet.idade : ''} ${pet.sexo ? '‚Ä¢ ' + pet.sexo : ''}`.trim();
        balaoContainer.appendChild(b);
      }

      const clouds = document.getElementById('clouds');
      clouds.innerHTML = '';

      function addCloud(text, extraClass = '') {
        if(!text) return;
        const s = document.createElement('span');
        s.className = 'cloud ' + extraClass;
        s.textContent = text;
        clouds.appendChild(s);
      }

      addCloud(pet.local || pet.cidade || 'Local n√£o informado');
      if (tipo?.nome) addCloud(tipo.nome);
      if (pet.raca) addCloud(pet.raca);

      const isCastrado = String(pet.castrado) === "true" || pet.castrado === true;
      const isVacinado = String(pet.vacinado) === "true" || pet.vacinado === true;

      addCloud(isCastrado ? 'Castrado' : 'N√£o castrado', 'small');
      addCloud(isVacinado ? 'Vacinado' : 'N√£o vacinado', 'small');

      const desc = document.getElementById('pet-descricao');
      desc.textContent = pet.descricao || 'O dono n√£o informou uma descri√ß√£o detalhada.';

      const btn = document.getElementById('btn-adotar');
      btn.onclick = () => {
        const nome = encodeURIComponent(pet.nome || 'pet');
        const msg = encodeURIComponent(`Ol√°! Vi o ${pet.nome} no site Adote Aqui e tenho interesse em adot√°-lo!`);
        const telefone = pet.telefone || "5511999999999"; 
        window.open(`https://wa.me/${telefone}?text=${msg}`, '_blank');
      };
    }
    
    (async function init() {
      const id = getPetId();
      if (!id) {
        showLocalError('Nenhum pet selecionado. Volte para a galeria.');
        return;
      }

      try {
        await carregarTipos();
        const pet = await carregarPet(id);
        montarInfos(pet);
      } catch (err) {
        console.error(err);
        showLocalError('Ops! N√£o conseguimos carregar os dados desse pet agora.');
      }
    })();
  </script>
</body>
</html>
